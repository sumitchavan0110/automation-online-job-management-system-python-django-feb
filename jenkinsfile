pipeline {
    agent any

    stages {
        stage('git clone') {
            steps {
                script {
                    sh "git clone https://github.com/sumitchavan0110/automation-online-job-management-system-python-django-feb.git"
                }
            }
        }

        stage('docker build') {
            steps {
                script {
                    sh '''
                        cd automation-online-job-management-system-python-django-feb
                        docker build -t sumitchavan0110/newjobportalimage .
                    '''
                    if (sh 'echo $?') {
                        error 'Docker build failed'
                    }
                }
            }
        }

        stage('Push Docker Images to Docker Hub') {
            steps {
                script {
                    // Log in to Docker Hub using Jenkins credentials
                    withCredentials([usernamePassword(credentialsId: 'docker-cred', usernameVariable: 'DOCKERHUB_USERNAME', passwordVariable: 'DOCKERHUB_PASSWORD')]) {
                        sh "docker login -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD"
                        // Push the Docker images to your Docker Hub repository
                        sh 'docker push sumitchavan0110/newjobportalimage'
                    }
                }
            }
        }

        stage('Start Minikube') {
            steps {
                sh '/usr/local/bin/minikube start'
                // Add any necessary validation or error handling
            }
        }

        stage('Kubectl deployment') {
            steps {
                sh '''
                    cd automation-online-job-management-system-python-django-feb
                    /usr/local/bin/kubectl apply -f deployment.yml
                '''
                // Add any necessary validation or error handling
            }
        }

        stage('Kubectl service') {
            steps {
                sh '''
                    cd automation-online-job-management-system-python-django-feb
                    /usr/local/bin/kubectl apply -f service.yml
                '''
                // Add any necessary validation or error handling
            }
        }

        stage('List Minikube Services') {
            steps {
                sh '/usr/local/bin/minikube service --all'
                // Add any necessary validation or error handling
            }
        }
    }
}
